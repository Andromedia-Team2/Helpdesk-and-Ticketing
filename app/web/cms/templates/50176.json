{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  var ticket = {};\n  if (user.user.role === \"Vendor\") {\n    ticket = await db.history_ticket.findMany({\n      where: {\n        id_vendor: user.user.dataUser.id_vendor,\n      },\n      include: {\n        level_ticket: true,\n        status_ticket: true,\n        client: true,\n        employee: true,\n        department: true,\n        ticket: {\n          include: {\n            jenis_ticket: true,\n          },\n        },\n      },\n    });\n  }\n  if (user.user.role === \"Employee\") {\n    ticket = await db.history_ticket.findMany({\n      where: {\n        id_department: user.user.dataUser.id_department,\n        OR: [\n          {\n            id_employee: user.user.dataUser.id_employee,\n          },\n          { id_employee: null },\n        ],\n      },\n      include: {\n        level_ticket: true,\n        status_ticket: true,\n        client: true,\n        employee: true,\n        department: true,\n        ticket: {\n          include: {\n            jenis_ticket: true,\n          },\n        },\n      },\n    });\n  }\n  if (user.user.role === \"Client\") {\n    ticket = await db.history_ticket.findMany({\n      where: {\n        id_client: user.user.dataUser.id_client,\n      },\n      orderBy: [\n        {\n          id_history_ticket: \"desc\",\n        },\n      ],\n      include: {\n        level_ticket: true,\n        status_ticket: true,\n        client: true,\n        employee: true,\n        department: true,\n        ticket: {\n          include: {\n            jenis_ticket: true,\n          },\n        },\n      },\n    });\n  }\n\n  reply.send({\n    data: ticket,\n  })\n}","figma":{}},"title":"get-ticket","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"66283","slug":"/api/get-ticket","site":"*","id":"50176"}