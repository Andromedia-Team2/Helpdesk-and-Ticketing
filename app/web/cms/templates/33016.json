{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  var summary = {};\n  if (user.user.role === \"Vendor\") {\n    var open = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 1,\n        id_vendor: user.user.dataUser.id_vendor,\n      },\n    });\n    var assign = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 2,\n        id_vendor: user.user.dataUser.id_vendor,\n      },\n    });\n    var progress = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 3,\n        id_vendor: user.user.dataUser.id_vendor,\n      },\n    });\n    var resolved = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 4,\n        id_vendor: user.user.dataUser.id_vendor,\n        solvedDay: new Date(),\n      },\n    });\n    summary = {\n      open: open,\n      assign: assign,\n      progress: progress,\n      resolved: resolved,\n    };\n  }\n\n  if (user.user.role === \"Employee\") {\n    var assign = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 2,\n        id_department: user.user.dataUser.id_department,\n      },\n    });\n    var progress = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 3,\n        id_employee: user.user.dataUser.id_employee,\n      },\n    });\n    var resolved = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 4,\n        id_employee: user.user.dataUser.id_employee,\n        solvedDay: new Date(),\n      },\n    });\n    summary = {\n      open: 0,\n      assign: assign,\n      progress: progress,\n      resolved: resolved,\n    };\n  }\n\n  if (user.user.role === \"Client\") {\n    var open = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 1,\n        id_client: user.user.dataUser.id_client,\n      },\n    });\n    var assign = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 2,\n        id_client: user.user.dataUser.id_client,\n      },\n    });\n    var progress = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 3,\n        id_client: user.user.dataUser.id_client,\n      },\n    });\n    var resolved = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 4,\n        id_client: user.user.dataUser.id_client,\n        solvedDay: new Date(),\n      },\n    });\n    summary = {\n      open: open,\n      assign: assign,\n      progress: progress,\n      resolved: resolved,\n    };\n  }\n\n  if (user.user.role === \"Super Admin\") {\n    var open = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 1,\n      },\n    });\n    var assign = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 2,\n      },\n    });\n    var progress = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 3,\n      },\n    });\n    var resolved = await db.history_ticket.count({\n      where: {\n        id_status_ticket: 4,\n      },\n    });\n    summary = {\n      open: open,\n      assign: assign,\n      progress: progress,\n      resolved: resolved,\n    };\n  }\n\n  reply.send({\n    data: summary,\n  })\n}","figma":{}},"title":"get-sum","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"66283","slug":"/api/get-sum","site":"*","id":"33016"}